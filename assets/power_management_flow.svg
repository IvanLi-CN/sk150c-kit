<?xml version="1.0" encoding="UTF-8"?>
<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font-family: Arial, sans-serif; font-size: 18px; font-weight: bold; text-anchor: middle; }
      .state { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; text-anchor: middle; fill: white; }
      .label { font-family: Arial, sans-serif; font-size: 12px; text-anchor: middle; }
      .pin-label { font-family: Arial, sans-serif; font-size: 11px; text-anchor: middle; }
      .arrow { stroke: #333; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .standby-box { fill: #4CAF50; stroke: #2E7D32; stroke-width: 2; }
      .working-box { fill: #2196F3; stroke: #1565C0; stroke-width: 2; }
      .hardware-box { fill: #FF9800; stroke: #E65100; stroke-width: 2; }
      .button-box { fill: #9C27B0; stroke: #4A148C; stroke-width: 2; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="400" y="30" class="title">SK150C 电源管理系统流程图</text>
  
  <!-- System Start -->
  <circle cx="400" cy="80" r="20" fill="#E0E0E0" stroke="#757575" stroke-width="2"/>
  <text x="400" y="85" class="label">系统启动</text>
  
  <!-- Arrow to Standby -->
  <line x1="400" y1="100" x2="400" y2="140" class="arrow"/>
  
  <!-- Standby State -->
  <rect x="300" y="150" width="200" height="80" rx="10" class="standby-box"/>
  <text x="400" y="175" class="state">待机状态 (Standby)</text>
  <text x="400" y="195" class="label">• LED 呼吸灯效果 (3秒周期)</text>
  <text x="400" y="210" class="label">• 电源开关断开 (PA15=HIGH)</text>
  
  <!-- Long Press Button -->
  <rect x="50" y="280" width="150" height="60" rx="10" class="button-box"/>
  <text x="125" y="305" class="state">长按按钮</text>
  <text x="125" y="320" class="label">PB8 长按 1.5秒</text>
  
  <!-- Arrow from button to states -->
  <line x1="200" y1="310" x2="280" y2="310" class="arrow"/>
  <line x1="280" y1="310" x2="280" y2="190" class="arrow"/>
  
  <!-- Bidirectional arrow between states -->
  <line x1="300" y1="170" x2="250" y2="170" class="arrow"/>
  <line x1="250" y1="170" x2="250" y2="390" class="arrow"/>
  <line x1="250" y1="390" x2="300" y2="390" class="arrow"/>
  
  <!-- Return arrow -->
  <line x1="500" y1="390" x2="550" y2="390" class="arrow"/>
  <line x1="550" y1="390" x2="550" y2="170" class="arrow"/>
  <line x1="550" y1="170" x2="500" y2="170" class="arrow"/>
  
  <!-- Working State -->
  <rect x="300" y="350" width="200" height="80" rx="10" class="working-box"/>
  <text x="400" y="375" class="state">工作状态 (Working)</text>
  <text x="400" y="395" class="label">• LED 完全熄灭</text>
  <text x="400" y="410" class="label">• 电源开关闭合 (PA15=LOW)</text>
  
  <!-- Hardware Connections -->
  <text x="650" y="100" class="title">硬件连接</text>
  
  <!-- PB8 Button -->
  <rect x="580" y="120" width="140" height="40" rx="5" class="hardware-box"/>
  <text x="650" y="140" class="pin-label">PB8 - 电源按钮</text>
  <text x="650" y="155" class="pin-label">高电平有效，长按1.5秒</text>
  
  <!-- PA8 LED -->
  <rect x="580" y="180" width="140" height="40" rx="5" class="hardware-box"/>
  <text x="650" y="200" class="pin-label">PA8 - LED指示灯 (TIM1_CH1)</text>
  <text x="650" y="215" class="pin-label">开漏输出，PWM呼吸灯</text>
  
  <!-- PA15 Power Switch -->
  <rect x="580" y="240" width="140" height="40" rx="5" class="hardware-box"/>
  <text x="650" y="260" class="pin-label">PA15 - 电源开关控制</text>
  <text x="650" y="275" class="pin-label">低电平闭合，高电平断开</text>
  
  <!-- State Machine Logic -->
  <text x="400" y="480" class="title">状态机逻辑</text>
  
  <rect x="50" y="500" width="700" height="80" rx="10" fill="#F5F5F5" stroke="#BDBDBD" stroke-width="1"/>
  <text x="400" y="520" class="label">1. 系统上电默认进入待机状态</text>
  <text x="400" y="535" class="label">2. 长按PB8按钮触发状态切换：待机状态 ↔ 工作状态</text>
  <text x="400" y="550" class="label">3. 状态切换时同步更新LED控制和电源开关状态</text>
  <text x="400" y="565" class="label">4. 呼吸灯效果仅在待机状态下运行，使用50Hz更新频率确保平滑</text>
</svg>
