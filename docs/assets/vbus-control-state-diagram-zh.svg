<?xml version="1.0" encoding="UTF-8"?>
<svg width="1400" height="900" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <!-- Flat Design - No gradients, transparent background -->
    <style>
      /* Flat Design Styles for Light Background */
      .state-box {
        fill: #3b82f6;
        stroke: #1e40af;
        stroke-width: 2;
        rx: 8;
      }
      .power-led-box {
        fill: #f59e0b;
        stroke: #d97706;
        stroke-width: 2;
        rx: 8;
      }
      .vbus-led-box {
        fill: #8b5cf6;
        stroke: #7c3aed;
        stroke-width: 2;
        rx: 8;
      }
      .transition-arrow {
        stroke: #374151;
        stroke-width: 2.5;
        marker-end: url(#arrowhead);
      }
      .condition-text {
        font-family: 'Microsoft YaHei', 'Segoe UI', Arial, sans-serif;
        font-size: 11px;
        font-weight: 500;
        fill: #374151;
      }
      .condition-vin { fill: #2563eb; font-weight: 600; }
      .condition-button { fill: #059669; font-weight: 600; }
      .condition-vbus { fill: #dc2626; font-weight: 600; }
      .state-text {
        font-family: 'Microsoft YaHei', 'Segoe UI', Arial, sans-serif;
        font-size: 14px;
        font-weight: 700;
        fill: #ffffff;
        text-anchor: middle;
      }
      .led-text {
        font-family: 'Microsoft YaHei', 'Segoe UI', Arial, sans-serif;
        font-size: 11px;
        font-weight: 600;
        fill: #ffffff;
      }
      .label-bg {
        fill: rgba(255,255,255,0.9);
        stroke: #d1d5db;
        stroke-width: 1;
        rx: 4;
      }
      .title-text {
        font-family: 'Microsoft YaHei', 'Segoe UI', Arial, sans-serif;
        font-size: 20px;
        font-weight: 700;
        fill: #1f2937;
      }
      .power-led-breathing { fill: #f59e0b; }
      .power-led-on { fill: #10b981; }
      .power-led-off { fill: #6b7280; }
      .vbus-led-green { fill: #10b981; }
      .vbus-led-red { fill: #ef4444; }
      .vbus-led-off { fill: #6b7280; }
      .legend-text {
        font-family: 'Microsoft YaHei', 'Segoe UI', Arial, sans-serif;
        font-size: 12px;
        font-weight: 500;
        fill: #374151;
      }
      .legend-title {
        font-family: 'Microsoft YaHei', 'Segoe UI', Arial, sans-serif;
        font-size: 16px;
        font-weight: 700;
        fill: #1f2937;
      }
    </style>

    <marker id="arrowhead" markerWidth="10" markerHeight="8" refX="9" refY="4" orient="auto">
      <polygon points="0 0, 10 4, 0 8" fill="#374151" />
    </marker>
  </defs>

  <!-- Transparent Background - No background element needed -->

  <!-- Transparent Background - No background element needed -->

  <!-- Title -->
  <text x="700" y="40" text-anchor="middle" class="title-text">USB-C 电源输出开关控制状态图</text>

  <!-- Main System States -->
  <!-- VIN_OFF State -->
  <rect x="120" y="80" width="180" height="90" class="state-box"/>
  <text x="210" y="110" class="state-text">VIN 关闭</text>
  <text x="210" y="130" text-anchor="middle" class="condition-text">输入电源关闭</text>
  <text x="210" y="150" text-anchor="middle" class="condition-text">VBUS 强制关闭</text>

  <!-- VBUS_DISABLED State -->
  <rect x="480" y="240" width="180" height="90" class="state-box"/>
  <text x="570" y="270" class="state-text">VBUS 关闭</text>
  <text x="570" y="290" text-anchor="middle" class="condition-text">VBUS 输出关闭</text>
  <text x="570" y="310" text-anchor="middle" class="condition-text">等待切换</text>

  <!-- VBUS_ENABLED State -->
  <rect x="800" y="240" width="180" height="90" class="state-box"/>
  <text x="890" y="270" class="state-text">VBUS 开启</text>
  <text x="890" y="290" text-anchor="middle" class="condition-text">VBUS 输出开启</text>
  <text x="890" y="310" text-anchor="middle" class="condition-text">电源传输激活</text>

  <!-- Power LED States (PA8 - 电源指示灯) -->
  <text x="200" y="400" text-anchor="middle" class="legend-title">电源指示灯 (PA8)</text>

  <!-- POWER_LED_BREATHING -->
  <rect x="120" y="420" width="160" height="65" class="power-led-box"/>
  <circle cx="150" cy="445" r="8" class="power-led-breathing"/>
  <text x="175" y="445" class="led-text">呼吸</text>
  <text x="175" y="465" text-anchor="start" class="condition-text">VIN 关闭</text>

  <!-- POWER_LED_ON -->
  <rect x="320" y="420" width="160" height="65" class="power-led-box"/>
  <circle cx="350" cy="445" r="8" class="power-led-on"/>
  <text x="375" y="445" class="led-text">常亮</text>
  <text x="375" y="465" text-anchor="start" class="condition-text">VIN+VBUS 开启</text>

  <!-- POWER_LED_OFF -->
  <rect x="520" y="420" width="160" height="65" class="power-led-box"/>
  <circle cx="550" cy="445" r="8" class="power-led-off"/>
  <text x="575" y="445" class="led-text">熄灭</text>
  <text x="575" y="465" text-anchor="start" class="condition-text">其他情况</text>

  <!-- VBUS LED States (PB5 - VBUS指示灯) -->
  <text x="900" y="400" text-anchor="middle" class="legend-title">VBUS指示灯 (PB5)</text>

  <!-- VBUS_LED_GREEN_BLINK -->
  <rect x="750" y="420" width="150" height="65" class="vbus-led-box"/>
  <circle cx="780" cy="445" r="8" class="vbus-led-green"/>
  <text x="805" y="440" class="led-text">绿灯</text>
  <text x="805" y="455" text-anchor="start" class="condition-text">闪烁 &lt;5.5V</text>

  <!-- VBUS_LED_GREEN_SOLID -->
  <rect x="950" y="420" width="150" height="65" class="vbus-led-box"/>
  <circle cx="980" cy="445" r="8" class="vbus-led-green"/>
  <text x="1005" y="440" class="led-text">绿灯</text>
  <text x="1005" y="455" text-anchor="start" class="condition-text">常亮 &lt;5.5V</text>

  <!-- VBUS_LED_RED_BLINK -->
  <rect x="750" y="510" width="150" height="65" class="vbus-led-box"/>
  <circle cx="780" cy="535" r="8" class="vbus-led-red"/>
  <text x="805" y="530" class="led-text">红灯</text>
  <text x="805" y="545" text-anchor="start" class="condition-text">闪烁 ≥5.5V</text>

  <!-- VBUS_LED_RED_SOLID -->
  <rect x="950" y="510" width="150" height="65" class="vbus-led-box"/>
  <circle cx="980" cy="535" r="8" class="vbus-led-red"/>
  <text x="1005" y="530" class="led-text">红灯</text>
  <text x="1005" y="545" text-anchor="start" class="condition-text">常亮 ≥5.5V</text>

  <!-- Main State Transitions -->
  <!-- VIN_OFF to VBUS_DISABLED -->
  <line x1="300" y1="140" x2="480" y2="260" class="transition-arrow"/>
  <rect x="360" y="190" width="100" height="18" class="label-bg"/>
  <text x="370" y="202" class="condition-text condition-vin">VIN > 5V</text>

  <!-- VBUS_DISABLED to VIN_OFF -->
  <line x1="480" y1="260" x2="300" y2="160" class="transition-arrow"/>
  <rect x="360" y="220" width="100" height="18" class="label-bg"/>
  <text x="370" y="232" class="condition-text condition-vin">VIN &lt; 5V</text>

  <!-- VBUS_DISABLED to VBUS_ENABLED -->
  <line x1="660" y1="285" x2="800" y2="285" class="transition-arrow"/>
  <rect x="710" y="273" width="70" height="18" class="label-bg"/>
  <text x="720" y="285" class="condition-text condition-button">短按按键</text>

  <!-- VBUS_ENABLED to VBUS_DISABLED -->
  <line x1="800" y1="305" x2="660" y2="305" class="transition-arrow"/>
  <rect x="710" y="313" width="70" height="18" class="label-bg"/>
  <text x="720" y="325" class="condition-text condition-button">短按按键</text>

  <!-- VBUS_ENABLED to VIN_OFF -->
  <path d="M 890 240 Q 590 120 300 140" fill="none" class="transition-arrow"/>
  <rect x="540" y="150" width="100" height="18" class="label-bg"/>
  <text x="550" y="162" class="condition-text condition-vin">VIN &lt; 5V</text>

  <!-- Power LED Connections -->
  <!-- VIN_OFF to POWER_LED_BREATHING -->
  <line x1="210" y1="170" x2="200" y2="420" class="transition-arrow" stroke-dasharray="6,3" stroke="#d97706"/>

  <!-- VBUS_ENABLED to POWER_LED_ON (only when both VIN and VBUS are on) -->
  <line x1="890" y1="330" x2="400" y2="420" class="transition-arrow" stroke-dasharray="6,3" stroke="#d97706"/>
  <rect x="600" y="360" width="140" height="18" class="label-bg"/>
  <text x="610" y="372" class="condition-text" style="fill:#d97706; font-weight:600;">VIN开启+VBUS开启</text>

  <!-- Other states to POWER_LED_OFF -->
  <line x1="570" y1="330" x2="600" y2="420" class="transition-arrow" stroke-dasharray="6,3" stroke="#d97706"/>
  <rect x="570" y="360" width="80" height="18" class="label-bg"/>
  <text x="580" y="372" class="condition-text" style="fill:#d97706; font-weight:600;">其他情况</text>

  <!-- VBUS LED Connections -->
  <!-- VBUS_DISABLED connections -->
  <line x1="540" y1="330" x2="825" y2="420" class="transition-arrow" stroke-dasharray="4,2" stroke="#7c3aed"/>
  <rect x="650" y="360" width="110" height="18" class="label-bg"/>
  <text x="660" y="372" class="condition-text condition-vbus">VBUS &lt; 5.5V</text>

  <line x1="600" y1="330" x2="825" y2="510" class="transition-arrow" stroke-dasharray="4,2" stroke="#7c3aed"/>
  <rect x="680" y="400" width="110" height="18" class="label-bg"/>
  <text x="690" y="412" class="condition-text condition-vbus">VBUS ≥ 5.5V</text>

  <!-- VBUS_ENABLED connections -->
  <line x1="860" y1="330" x2="1025" y2="420" class="transition-arrow" stroke-dasharray="4,2" stroke="#7c3aed"/>
  <rect x="920" y="360" width="110" height="18" class="label-bg"/>
  <text x="930" y="372" class="condition-text condition-vbus">VBUS &lt; 5.5V</text>

  <line x1="920" y1="330" x2="1025" y2="510" class="transition-arrow" stroke-dasharray="4,2" stroke="#7c3aed"/>
  <rect x="950" y="400" width="110" height="18" class="label-bg"/>
  <text x="960" y="412" class="condition-text condition-vbus">VBUS ≥ 5.5V</text>

  <!-- Legend -->
  <rect x="100" y="620" width="1200" height="160" fill="rgba(255,255,255,0.95)" stroke="#d1d5db" stroke-width="2" rx="8"/>
  <text x="130" y="650" class="legend-title">图例说明</text>

  <!-- Legend Items -->
  <line x1="130" y1="670" x2="180" y2="670" class="transition-arrow"/>
  <text x="190" y="675" class="legend-text">主状态转换</text>

  <line x1="130" y1="690" x2="180" y2="690" class="transition-arrow" stroke-dasharray="6,3" stroke="#d97706"/>
  <text x="190" y="695" class="legend-text">电源指示灯连接</text>

  <line x1="130" y1="710" x2="180" y2="710" class="transition-arrow" stroke-dasharray="4,2" stroke="#7c3aed"/>
  <text x="190" y="715" class="legend-text">VBUS指示灯连接</text>

  <!-- Color Coding Legend -->
  <text x="400" y="675" class="legend-text condition-vin">■ VIN 条件（蓝色）</text>
  <text x="400" y="695" class="legend-text condition-button">■ 按键操作（绿色）</text>
  <text x="400" y="715" class="legend-text condition-vbus">■ VBUS 阈值（红色）</text>

  <!-- LED Systems -->
  <text x="700" y="675" class="legend-text" style="fill:#d97706; font-weight:600;">■ 电源指示灯 (PA8)</text>
  <text x="700" y="695" class="legend-text" style="fill:#7c3aed; font-weight:600;">■ VBUS指示灯 (PB5)</text>

  <!-- Detailed Explanations -->
  <text x="130" y="740" class="legend-text">• 电源指示灯：VIN关闭时呼吸，VIN+VBUS都开启时常亮，其他情况熄灭</text>
  <text x="130" y="760" class="legend-text">• VBUS指示灯：电压决定颜色（&lt;5.5V=绿色，≥5.5V=红色），状态决定模式（关闭=闪烁，开启=常亮）</text>
</svg>
